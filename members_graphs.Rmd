---
title: "Bangladesh Household Profile"
author: "Sotaire"
date: "June 12, 2023"
output:
  html_document:
    df_print: paged
  pdf_document: default
---


```{r setup, include=FALSE, echo=FALSE, message=FALSE, comment=F}
knitr::opts_chunk$set(
	echo = FALSE,
	warning = FALSE

)
library(psych)
library(knitr)
library(stargazer)
library(tidyverse)
library(dplyr)
library(fpp3)
library(gridExtra) 
library(GGally)
library(readxl)
library(haven)
library(foreign)
library(epiDisplay)
library(ggeasy)
library(patchwork)
library(viridis)
library (mice)
library(plotly)
```

# HH member dataset 

```{r Loading BIHS dataset , echo=TRUE}
data_mem <- read_dta("BIHS2018-19Members_Jun3.dta")
attach(data_mem)


```


```{r Total individuals, echo=FALSE}

## Total population by gender

library(dplyr)

g <- data_mem %>%
  count(gender) %>%
  rename(Gender = gender, Total = n) %>%
  mutate(Gender = as.character(haven::zap_labels(Gender)),
         Gender = recode(Gender, "0" = "Male", "1" = "Female")) %>%
  bind_rows(data.frame(Gender = "Total", Total = sum(.$Total)))


```

## Average age by gender and division

There are no significant age variations between males and females. However, females tend to be slightly older than males. In Khulna, the average age for males is 30.44 years, while for females, it is 31.77 years, making it the city with the highest average age for both genders. Conversely, in Chittagong, the average age is the lowest, with males averaging 26.13 years and females averaging 27.79 years. 

```{r Household average age, echo = F}
avg <- data_mem %>%
  rename("Division" = div_name, "Gender" = gender) %>% 
  mutate(Gender = as.character(haven::zap_labels(Gender)),
         Gender = recode(Gender,
                         "1" = "Female",
                         "0" = "Male")) %>%
  group_by(Division, Gender) %>%
  summarize(Mean_age = round(mean(age), 2),
            std_dev = round(sd(age), 2),
            count = n())



  avg$Gender <- factor(avg$Gender, levels = c("Male", "Female"))

  pgg <- ggplot(avg, aes(Division, Mean_age, fill = Gender))+
  geom_bar(position="dodge", stat="identity")+
  theme_classic()+
  labs(title = "Average Age by Division and Gender",
       x= "Division",
       y = "Mean age")+
  # geom_text(aes(label = paste0("( sd = ", round(std_dev, 1), ")")), position = position_dodge(width = 0.9), size = 3, vjust = -2.5, face = "bold")+
  # geom_bar(position = "dodge", aes( text = paste("Division:", Division, "Mean Age:", Mean_age, "Gender:", Gender) )) +
  scale_fill_manual(values = c("Male" = "#21918c", "Female" = "#cc4778")) +
  easy_y_axis_title_size(size = 15)+
  easy_x_axis_title_size(size = 15)+
  easy_plot_title_size(size = 16)+
  easy_center_title()+
  ylim(0, 35)
  
fig <- ggplotly(pgg)
fig



```

## Male age distribution 

Across all divisions, the age range with the highest male population is 31-65 years  Khulna has the highest percent of people in that category(40.76%). It is also important to note that around 15 percent of the male population consists of children under the age of 5 across all divisions.   


```{r Male age distribution }


age_div_male <- data_mem %>% 
  filter(gender == 0) %>% 
  rename("Division" = div_name, "Gender" = gender, "Age_range" = age_categorical) %>% 
  group_by(Division) %>% 
  count(Age_range) %>% 
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Age_range = as.character(haven::zap_labels(Age_range)),
         Age_range = recode(Age_range, "0" =  "0-5 yrs",
                                   "1" = "6-10 yrs",
                                   "2" = "11-17 yrs",
                                   "3" = "18-30 yrs",
                                   "4" = "31-65 yrs",
                                                    
                                   "5" = "65-80 yrs",
                                   "6" = "80+ yrs"))

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


p_ma<- ggplot(age_div_male, 
       aes(Division, Percentage, fill = Age_range))+
geom_bar(position="dodge", stat="identity")+
scale_fill_viridis_d() +
theme_classic()+
scale_fill_manual(values = c("0-5 yrs" = "#440154", "6-10 yrs" = "#fde725",
                               "11-17 yrs" = "#3a528b", "18-30 yrs" = "#21918c", 
                               "31-65 yrs" = "#ff7f00","65-80 yrs" = "#bd93f5", 
                               "#5ec962", "#cc4778",
                               "80+ yrs" = "#f6c2f8"))+
labs(title = "Age Distribution of Male by Division",
         x= "Division",
         y = "Percentage")+
easy_plot_title_size(size = 16)+
# easy_all_text_colour("#630031")+
easy_center_title()+
# geom_text(aes(label = round(Percentage, 1)), size = 4, vjust = -4, face = "bold")+
ggeasy::easy_rotate_labels(which = "x", angle = 300)+
ylim(0,50)
p_ma <- ggplotly(p_ma)
p_ma

```

## Female age distribution

Similary to their male counterpart, the 31-65 years age range holds big chunk of female population. Again Khulna is leading with 43.74 % of falling under the 31-65 age category. Also childeren the age of 5 account for around 10 percent aacross all divisions.


```{r Female age distribution}
age_div_female<-data_mem%>% 
  filter(gender == 1) %>% 
  rename("Division" = div_name, "Gender" = gender, "Age_range" = age_categorical) %>% 
  group_by(Division) %>% 
  count(Age_range) %>% 
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Age_range = as.character(haven::zap_labels(Age_range)),
         Age_range = recode(Age_range, "0" =  "0-5 yrs",
                                   "1" = "6-10 yrs",
                                   "2" = "11-17 yrs",
                                   "3" = "18-30 yrs",
                                   "4" = "31-65 yrs",
                                                    
                                   "5" = "65-80 yrs",
                                   "6" = "80+ yrs"))

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


p_fe <- ggplot(age_div_female, aes(Division, Percentage, fill = Age_range)) +
  geom_bar(position = "dodge", stat = "identity") +
  scale_fill_viridis_d() +  # Set colors to viridis defaults
  theme_classic() +
  scale_fill_manual(values = c("0-5 yrs" = "#440154", "6-10 yrs" = "#fde725",
                               "11-17 yrs" = "#3a528b", "18-30 yrs" = "#21918c", 
                               "31-65 yrs" = "#ff7f00","65-80 yrs" = "#bd93f5", 
                               "#5ec962", "#cc4778",
                               "80+ yrs" = "#f6c2f8"))+
  # easy_all_text_colour("#630031") +
  labs(title = "Age Distribution of Female by Division", x = "Division", y = "Percentage") +
  easy_plot_title_size(size = 16) +
  easy_center_title() +
  ggeasy::easy_rotate_labels(which = "x", angle = 300) +
  ylim(0, 50)

# Rotate x-axis labels
# p_fe <- easy_rotate_labels(p_fe, which = "x", angle = 300)

# Convert ggplot object to plotly object
p_fe <- ggplotly(p_fe)

# Display the interactive plot
p_fe









```


```{r}
# Literacy among males
# literacy_m <- data_mem[which(data_mem$gender==09),] %>% 
#   rename("Division" = div_name, "Gender" = gender, "Literacy" = b1_07) %>% 
#   group_by(Literacy) %>% 
#   count() %>% 
#   mutate("Percentage" = round(n/10818*100, 2))%>%
#   rename("Total" = n) %>% 
#   mutate(Literacy = as.character(haven::zap_labels(Literacy)),
#          Literacy = recode(Literacy, "1" = "Cannot read and write",
#                            "2" = "Can only sign",
#                            "3" = "Can read only",
#                            "4" = "Can read and write")) 
# literacy_m
# 
# dims = dim(literacy_m)
# pie = ggplot(literacy_m, aes(x = "", y = Total, fill = Literacy)) +
#     geom_bar(width = 1, stat = "identity") + # this plots a stacked bar chart
#     coord_polar(theta = "y", start = 0)+ # convert the above bar chart to a pie chart
#     theme_void()+
#     geom_text(aes(y = Total/3 + c(0, cumsum(Total)[-length(Total)]),
#                   label = percent(Total/dims[3])), # frequencies (size labels)
#               color = "black", size = 4, hjust = 0.99999999999999999, vjust = -4)
# pie

```

## Male education by division 

Although there are more males with no education than females, we observe that a higher percentage of males than females making it higher education.However, Sylhet still has the has the lowest percentage (4.16 %) of males in higher education.




```{r male education}


edu_div_male <- data_mem %>% 
  filter(gender == 0) %>% 
  rename("Division" = div_name, "Gender" = gender, "Education_level" = educ) %>% 
  group_by(Division) %>% 
  count(Education_level) %>% 
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Education_level = as.character(haven::zap_labels(Education_level)),
         Education_level = recode(Education_level,  "4" = "Higher",
                                                    "3" = "Completed secondary",
                                                    "2" = "Completed primary",
                                                    "1" = "Less than primary",
                                                    "0" = "No education"))

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


edu_div_male$Education_level <- factor(edu_div_male$Education_level, levels = c("Higher",
                                                                                "Completed secondary",
                                                                                "Completed primary",
                                                                                "Less than primary",
                                                                                "No education"))

p_m <- ggplot(edu_div_male, aes(Division, Percentage, fill = Education_level)) +
  geom_bar(position = "stack", stat = "identity") + #, aes(text = paste0(Percentage, "%"))
  theme_classic() +
   scale_fill_viridis_d() +
  scale_fill_manual(values = c("No education" = "#440154", "Less than primary" = "#fde725",
                               "Completed primary" = "#3a528b", "Completed secondary" = "#21918c", 
                               "Higher" = "#ff7f00"))+
  labs(
    title = "Educational Attainment of Males by Division",
    x = "Division",
    y = "Percentage"
  ) +
  easy_plot_title_size(size = 16) +
  # easy_all_text_colour("#630031") +
  easy_center_title() +
  # ggeasy::easy_rotate_labels(which = "x", angle = 300) +
  ylim(0, 100) +
  coord_flip()

p_m <- ggplotly(p_m)  #, tooltip = "text"

p_m 

```

## Female education by division 

In general, most female have no formal education or only completed primary education across all divisions. Rangpur has the highest percentage of no educated female(42.55 %). The percent of female who manage to go past secondary school is between 2.83 to 5.15 %. 



```{r female education}



edu_div_female <- data_mem %>% 
  filter(gender == 1) %>% 
  rename("Division" = div_name, "Gender" = gender, "Education_level" = educ) %>% 
  group_by(Division) %>% 
  count(Education_level) %>% 
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Education_level = as.character(haven::zap_labels(Education_level)),
         Education_level = recode(Education_level,  "4" = "Higher",
                                                    "3" = "Completed secondary",
                                                    "2" = "Completed primary",
                                                    "1" = "Less than primary",
                                                    "0" = "No education"))

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))

edu_div_female$Education_level <- factor(edu_div_female$Education_level,
                                         levels = c("Higher",
                                                    "Completed secondary",
                                                    "Completed primary",
                                                    "Less than primary",
                                                    "No education"))

p_f <- ggplot(edu_div_female, aes(Division, Percentage, fill = Education_level)) +
  geom_bar(position = "stack", stat = "identity") + #, aes(text = paste0(Percentage, "%"))
  scale_fill_viridis_d() +
  theme_classic() +
  scale_fill_manual(values = c("No education" = "#440154" , "Less than primary" = "#fde725",
                               "Completed primary" = "#3a528b", "Completed secondary" = "#21918c", 
                               "Higher" = "#ff7f00"))+
  # easy_all_text_colour("#630031") +
  labs(title = "Educational Attainment of Females by Division",
       x = "Division",
       y = "Percentage") +
  easy_plot_title_size(size = 16) +
  coord_flip()

p_f <- ggplotly(p_f)#, tooltip = "text"
p_f



```


# Household dataset 

```{r, echo=TRUE}
data_h <- read_dta("BIHS2018-19HH_Jun3.dta")
# attach(data_h)

## Number of households by division

hh <- data_h %>%
  rename("Division" = div_name) %>%
  group_by(Division) %>% 
  count() %>% 
  rename("Total" = n) %>% 
  bind_rows(data.frame(Division = "Total", Total = sum(.$Total)))

```



## Household size by division

The average hiusehold size is around 4.2 people accross all divisions. Sylhet has relatively large households with an average household size of 4.93 members.

```{r Household size}
  


HH_size <- data_h %>% 
  rename("Division" = div_name,  "HH_size" = hhsize) %>% 
  group_by(Division) %>% 
  summarise("Mean_HH_size" = round(mean(HH_size), 2),
            "std_dev" = round(sd(HH_size), 2),
            count = n()) 


p_hh<- ggplot(HH_size, 
       aes(Division, Mean_HH_size, fill = Division))+
geom_bar(position="dodge", stat="identity")+
 theme_classic()+
labs(title = "Average Household Size by Division",
         x= "Division",
         y = "Mean_HH_size")+
easy_remove_legend()+
scale_fill_viridis_d() + 
easy_plot_title_size(size = 16)+
easy_all_text_size(size = 13)+
# easy_all_text_colour("#630031")+
easy_center_title()+
# geom_text(aes(label = round(Percentage, 1)), size = 4, vjust = -4, face = "bold")+
ggeasy::easy_rotate_labels(which = "x", angle = 300)+
ylim(0,7)
  
p_ly <- ggplotly(p_hh)
p_ly




```

## Dependency ration

The dependency is below 40 percent across all divisions, meaning that in most households have a higher share of independent household members 





```{r Dependenncy ration}
## Dependency ration

dep_r <- data_h %>% 
  rename("Division" = div_name,  "Dependency_ratio" = depratio) %>% 
  group_by(Division) %>% 
  summarise("Dependency_ratio" = round(mean(Dependency_ratio), 2),
            "std_dev" = round(sd(Dependency_ratio, na.rm = FALSE), 2),
            count = n()) 


p_depr<- ggplot(dep_r, 
       aes(Division, Dependency_ratio, fill = Division))+
geom_bar(position="dodge", stat="identity")+
 theme_classic()+
labs(title = "Dependency Ratio by Division",
         x= "Division",
         y = "Dependency_ratio")+
scale_fill_viridis_d() + 
easy_remove_legend()+
easy_plot_title_size(size = 16)+
easy_all_text_size(size = 13)+
# easy_all_text_colour("#630031")+
easy_center_title()+
# geom_text(aes(label = round(Percentage, 1)), size = 4, vjust = -4, face = "bold")+
ggeasy::easy_rotate_labels(which = "x", angle = 300)+
ylim(0, 0.5)
  
ply <- ggplotly(p_depr)
ply
```
In this graph, we see that more than half of the sampled households report completed primary as their highest household educational attainment across all divisions. We also see that Rangpur has the highest percentage (10.84 %)of households whose members have no formal education.

```{r}
## Highest education in the household

hh_edu_div <- data_h %>%
  rename(Division = div_name, Education_level  = maxeduc) %>%
  group_by(Division, Education_level) %>%
  count() %>%
  ungroup() %>%
  group_by(Division) %>%
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Education_level = as.character(Education_level),  # Convert to character
         Education_level = dplyr::recode(Education_level,
                                               "0" = "No education",
                                               "1" = "Less than primary",
                                               "2" = "Completed primary",
                                               "3" = "Completed secondary",
                                               "4" = "Higher"))

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


hh_edu_div$Education_level <- factor(hh_edu_div$Education_level,
                                         levels = c("Higher",
                                                    "Completed secondary",
                                                    "Completed primary",
                                                    "Less than primary",
                                                    "No education"))

p_h <- ggplot(hh_edu_div, aes(Division, Percentage, fill = Education_level)) +
  geom_bar(stat = "identity", position = "dodge") + #, aes(text = paste0(Percentage, "%"))
  labs(title = "Highest HH Education Level by Division",
    x = "Division",
    y = "Percentage") +
  scale_fill_manual(values = c("No education" = "#440154", "Less than primary" = "#fde725",
                               "Completed primary" = "#3a528b", "Completed secondary" = "#21918c", 
                               "Higher" = "#ff7f00"))+
  easy_center_title() +
  theme_classic() +
  easy_plot_title_size(size = 16) +
  
  ggeasy::easy_rotate_labels(which = "x", angle = 300) +
  ylim(0, 70)

fig1 <- ggplotly(p_h)
fig1









```

## Household invovement in farming activities 

Most households primarily engage in farming activities, with approximately 90% of them relying on subsistence farming. Livestock farming is the prevalent agricultural pursuit, and Rangpur has the highest proportion of households (89.51%) involved in this sector.

```{r}
hh_rfarm <- data_h %>%
  rename(Division = div_name, Crop_Farming = cropfarming, Rice_Farming = ricefarming, Livestock_Farming = livestockfarming, Fish_Farming = fishfarming, Farm_HH = farmhh) %>%
  pivot_longer(cols = c(Crop_Farming, Rice_Farming, Livestock_Farming, Fish_Farming, Farm_HH), names_to = "Activity", values_to = "Value") %>%
  group_by(Division, Activity, Value) %>%
  count() %>%
  ungroup() %>%
  group_by(Division, Activity) %>%
  mutate(Total = sum(n),
         Percentage = round(n / Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Activity = as.character(Activity),
         Activity = dplyr::recode(Activity,
                                 "Crop_Farming" = "Crop Farming",
                                 "Rice_Farming" = "Rice Farming",
                                 "Livestock_Farming" = "Livestock Farming",
                                 "Fish_Farming" = "Fish Farming",
                                 "Farm_HH" = "HHs in Farming")) %>%
  filter(Value != 0)

 


hh_rfarm$Activity <- factor(hh_rfarm$Activity, levels = c("HHs in Farming", "Crop Farming", "Rice Farming", "Livestock Farming", "Fish Farming"))

# Plotting the results
ag<- ggplot(hh_rfarm, aes(x = Division, y = Percentage, fill = Activity)) +
  geom_bar(position = position_dodge(width = 0.7), width = 0.7, stat = "identity") +
  xlab("Division") +
  ylab("Percentage") +
  ggtitle(" HHs in Agricultural Activities by Division") +
  theme_minimal() + 
  easy_plot_title_size(size = 16) +
  easy_center_title()+
  scale_fill_viridis_d() +coord_flip()

 

ggplotly(ag)


```

## distribution of cultivable land holding, by division

Chittagong has the highest percent (44.97%) of households without cultivable land. It is followed by Sylhet (43.09%)


```{r}


cult_land_div <- data_h %>%
  rename(Division = div_name, Farm_size = farmgroup) %>%
  group_by(Division, Farm_size) %>%
  count() %>%
  ungroup() %>%
  group_by(Division) %>%
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>% 
  ungroup() %>% 
  mutate(Farm_size = as.character(Farm_size),  # Convert to character
         Farm_size = dplyr::recode(Farm_size,
                                             "0" = "No cultivable land",
                                     
                                              "1" =  "marginal: <0.5 acres",  
  
                                              "2" = "small: 0.5 to <1.5 acres",  
                                            
                                             "3" = "medium: 1.5 to <2.5 acres",  
                                              
                                              "4" = "large: >= 2.5 acres"
                                              
                                            
                                         ))


  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


p_land <- ggplot(cult_land_div, aes(Division, Percentage, fill = Farm_size)) +
  geom_bar(position = "dodge", stat = "identity") +
  theme_classic() +
  labs(
    title = "Cultivable Land Holding by Division",
    x = "Division",
    y = "Percentage"
  ) +
  # scale_fill_viridis_d() + 
  scale_fill_manual(values = c("No cultivable land" = "#440154", "marginal: <0.5 acres" = "#fde725",
                               "small: 0.5 to <1.5 acres" = "#3a528b", "medium: 1.5 to <2.5 acres" = "#21918c", 
                               "large: >= 2.5 acres" = "#ff7f00"))+
  # coord_flip()+
  easy_plot_title_size(size = 16) +
  # easy_all_text_colour("#630031") +
  easy_center_title() +
  # ggeasy::easy_rotate_labels(which = "x", angle = 300) +
  ylim(0, 50)  

p_land <- ggplotly(p_land)

p_land





```
## Poverty rate by division 

Rangpur (17.13%) and Rajshahi(10.06%) stand out with their highest percentages of households living below the poverty line. 
Note: We are using the international poverty line of $ 1.96, adjusted for the 2011 purchasing power parity.

```{r Poverty rate by division}

under_ppp<-data_h%>% 
  rename("Division" = div_name, "Categories" = poorhh) %>% 
  group_by(Division) %>% 
  count(Categories) %>% 
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Categories = as.character(haven::zap_labels(Categories)),
         Categories = recode(Categories, "1" =  "< USD 1.96 2011 PPP",
                                   "0" = "> USD 1.96 2011 PPP",
                                  )) %>% 
  filter(Categories == "< USD 1.96 2011 PPP")


  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


p_ppp<-ggplot (under_ppp,
       aes(Division, Percentage, fill = Categories))+
geom_bar(position="dodge", stat="identity")+ #, aes(text = paste0(Percentage, "%"))
 theme_classic()+
labs(title = "Households Living Below Poverty Line by Division",
         x= "Division",
         y = "Percentage")+
scale_fill_viridis_d() + 
easy_plot_title_size(size = 16)+
# easy_all_text_colour("#630031")+
easy_center_title()+
# geom_text(aes(label = round(Percentage, 1)), size = 4, vjust = -4, face = "bold")+
ggeasy::easy_rotate_labels(which = "x", angle = 300)+
easy_remove_legend()+
ylim(0,20)
p_ppp <- ggplotly(p_ppp) #, tooltip = "text"
p_ppp


```

## Household access to electricity

Barisal (29.61%) and Rangpur (26.40) have the highest percentage of households without electricity. 


```{r Electrictry accessibility}
 

eletri<-data_h%>% 
  rename("Division" = div_name, "Electricity" = electricity) %>% 
  
  group_by(Division) %>% 
  count(Electricity) %>% 
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>% 
  # filter(electricity == 0) %>%
  ungroup() %>%
  
  mutate(Electricity = as.character(haven::zap_labels(Electricity)),
         Electricity = recode(Electricity, "1" =  "W/ electricity",
                                   "0" = "W/o electricity",
                                  )) %>% 
  filter(Electricity == "W/o electricity")

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


p_el<-ggplot (eletri,
       aes(Division, Percentage, fill = Electricity))+
geom_bar(position="dodge", stat="identity")+ #, aes(text = paste0(Percentage, "%"))
 theme_classic()+
labs(title = "Household Without Electricity by Division",
         x= "Division",
         y = "Percentage")+

scale_fill_viridis_d() + 
easy_plot_title_size(size = 16)+
# easy_all_text_colour("#630031")+
easy_center_title()+
# geom_text(aes(label = round(Percentage, 1)), size = 4, vjust = -4, face = "bold")+
ggeasy::easy_rotate_labels(which = "x", angle = 300)+
easy_remove_legend()+
ylim(0,30)
p_el <- ggplotly(p_el) #, tooltip = "text"
p_el



```

## Household access to improved drinking water source

Across all the divisions in Bangladesh, an average of 97.05% of households that took the survey reported to not have acess to improved water.

```{r Household access to improved drinking water source}

imp_h2o<-data_h%>% 
  rename("Division" = div_name, "Improved_water" = improvedwater) %>% 
  group_by(Division) %>% 
  count(Improved_water) %>% 
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Improved_water = as.character(haven::zap_labels(Improved_water)),
         Improved_water = recode(Improved_water, "1" =  "Unimproved_water",
                                   "0" = " Improved_water",
                                  )) %>% 
  filter(Improved_water == "Unimproved_water")

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


p_h2o<-ggplot (imp_h2o,
       aes(Division, Percentage, fill = Improved_water))+
geom_bar(position="dodge", stat="identity", aes(text = paste0(Percentage, "%")))+
scale_fill_viridis_d() + 
theme_classic()+
labs(title = "Household access to Improved_water, by division",
         x= "Division",
         y = "Percentage")+
easy_plot_title_size(size = 16)+
# easy_all_text_colour("#630031")+
easy_center_title()+
easy_remove_legend()+
# geom_text(aes(label = round(Percentage, 1)), size = 4, vjust = -4, face = "bold")+
ggeasy::easy_rotate_labels(which = "x", angle = 300)+
ylim(0,100)
p_h2o <- ggplotly(p_h2o, tooltip = "text")
p_h2o



```

## Households that do not filter drinking water before consumption

Across all the divisions in Bangladesh, an average of 95.06% of households that took the survey reported that they do not filter drinking water. The division with the highest percentage of people who do not filter their drinking water is Rangpur and the division with the lowest percentage of households that do not filter their drinking water is Sylhet.   

 
```{r Water treatment }



filt_h2o<-data_h%>% 
  rename("Division" = div_name, "Untreated_water" = untreatedwater) %>% 
  group_by(Division) %>% 
  count(Untreated_water) %>% 
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Untreated_water = as.character(haven::zap_labels(Untreated_water)),
         Untreated_water = recode(Untreated_water, "1" =  "Untreated Water",
                                   "0" = "Treated Water",
                                  )) %>% 
filter(Untreated_water == "Untreated Water")

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


p_h2o<-ggplot (filt_h2o,
       aes(Division, Percentage, fill = Untreated_water))+
geom_bar(position="dodge", stat="identity", aes(text = paste0(Percentage, "%")))+
 theme_classic()+
labs(title = "Households W/o Treated Drinking Water by Division",
         x= "Division",
         y = "Percentage")+
scale_fill_viridis_d() + 
easy_plot_title_size(size = 16)+
# easy_all_text_colour("#630031")+
easy_center_title()+
# geom_text(aes(label = round(Percentage, 1)), size = 4, vjust = -4, face = "bold")+
ggeasy::easy_rotate_labels(which = "x", angle = 300)+
easy_remove_legend()+
ylim(0,100)
p_h2o <- ggplotly(p_h2o, tooltip = "text")
p_h2o







```

## Household headship

Males are household heads in most of the families and across all divisions. Chittagong has the highest percentage (33.57%) of female household heads.



```{r HH headship}

 

hhh_gender<-data_h%>% 
  rename("Division" = div_name, "Gender" = headgender) %>% 
  group_by(Division) %>% 
  count(Gender) %>% 
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Gender = as.character(haven::zap_labels(Gender)),
         Gender = recode(Gender, "0" =  "Male",
                                   "1" = "Female",
                                  ))

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))

hhh_gender$Gender <- factor(hhh_gender$Gender,
                                         levels = c("Male",
                                                    "Female"))


p_h2o<-ggplot (hhh_gender,
       aes(Division, Percentage, fill = Gender))+
geom_bar(position="dodge", stat="identity")+
 theme_classic()+
labs(title = "Household Headship by Division",
         x= "Division",
         y = "Percentage")+
scale_fill_manual(values = c("Male" = "#21918c", "Female" = "#cc4778")) + 
easy_plot_title_size(size = 16)+
# easy_all_text_colour("#630031")+
easy_center_title()+
# geom_text(aes(label = round(Percentage, 1)), size = 4, vjust = -4, face = "bold")+
ggeasy::easy_rotate_labels(which = "x", angle = 300)+
ylim(0,100)
p_h2o <- ggplotly(p_h2o)
p_h2o



```

## HH_head age distribution

The most frequent household age across all of the divisions is "31-65 yrs". The least frequent household age is "80+ yrs". ' Some factors that contribute to this could be that people under 31 have migrated to cities or more developed areas in search of better educational and employment opportunities. 


```{r HH head age distribution}


hhh_age<-data_h%>% 
  rename("Division" = div_name, "Gender" = gender, "Age_category" = headagecat) %>% 
  group_by(Division) %>% 
  count(Age_category) %>% 
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Age_category = as.character(haven::zap_labels(Age_category)),
         Age_category = recode(Age_category, "0" =  "0-5 yrs",
                                   "1" = "6-10 yrs",
                                   "2" = "11-17 yrs",
                                   "3" = "18-30 yrs",
                                   "4" = "31-65 yrs",
                                                    
                                   "5" = "65-80 yrs",
                                   "6" = "80+ yrs"))

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


p_hhh<-ggplot (hhh_age,
       aes(reorder(Division, Percentage), Percentage, fill = Age_category))+
geom_bar(position="dodge", stat="identity", aes(text = paste0(Percentage, "%")))+
 theme_classic()+
labs(title = "Household head age distribution, by division",
         x= "Division",
         y = "Percentage")+
scale_fill_viridis_d() + 
scale_fill_manual(values = c("#440154", "#fde725",
                               "#3a528b", "#21918c", 
                               "#ff7f00","#bd93f5", 
                               "#5ec962", "#cc4778",
                               "#f6c2f8", "#b26600"))+
easy_plot_title_size(size = 16)+
# easy_all_text_colour("#630031")+
easy_center_title()+
# geom_text(aes(label = round(Percentage, 1)), size = 4, vjust = -4, face = "bold")+
ggeasy::easy_rotate_labels(which = "x", angle = 300)+
ylim(0,100)
p_hhh <- ggplotly(p_hhh, tooltip = "text")
p_hhh




```

## HH head education attainment 

The highest Household Head Education all the divisions except Chittagong is "No Education". In Chittagong, the highest is "Completed Primary". The least frequence education level amoung all of the divisions is "Completed Secondary" and "Higher".  

```{r HH head education attainment}



hhh_edu_div <- data_h %>%
  rename(Division = div_name, Education_level = headeduc) %>%
  group_by(Division, Education_level) %>%
  count() %>%
  ungroup() %>%
  group_by(Division) %>%
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Education_level = as.character(Education_level),  # Convert to character
         Education_level = dplyr::recode(Education_level,
                                               "0" = "No education",
                                               "1" = "Less than primary",
                                               "2" = "Completed primary",
                                               "3" = "Completed secondary",
                                               "4" = "Higher"))

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))

hhh_edu_div$Education_level <- factor(hhh_edu_div$Education_level,
                                         levels = c("Higher",
                                                    "Completed secondary",
                                                    "Completed primary",
                                                    "Less than primary",
                                                    "No education"))

p_h <- ggplot(hhh_edu_div, aes(Division, Percentage, fill = Education_level)) +
  geom_bar(position = "dodge", stat = "identity") +
  theme_classic() +
  labs(
    title = "Household Head Education Attainment by Division",
    x = "Division",
    y = "Percentage"
  ) +
  scale_fill_viridis_d() +
  scale_fill_manual(values = c("#440154", "#fde725",
                               "#3a528b", "#21918c", 
                               "#ff7f00","#bd93f5", 
                               "#5ec962", "#cc4778",
                               "#f6c2f8", "#b26600"))+
  easy_plot_title_size(size = 16) +
  # easy_all_text_colour("#630031") +
  easy_center_title() +
  ggeasy::easy_rotate_labels(which = "x", angle = 300) +
  ylim(0, 50)  

p_h <- ggplotly(p_h)

p_h




```
## HHH main occupation

In each division, farming is the most frequent occupation, with the largest number of farmers residing in Khulna. The second most frequent occupation in most divisions is non-earning occupations, primarily made up of mothers, nannies, and others. The occupation with the least frequency is livestock-related work, adding up to  less than 1 percent combined across the seven divisions. This could be caused by  the majority of agricultural land being used for crops and risk of damage caused by natural disasters to livestock. 


```{r HH head main occupation}


hhh_main_occup <- data_h %>%
  rename(Division = div_name, Occupations = headoccupation) %>%
  group_by(Division, Occupations) %>%
  count() %>%
  ungroup() %>%
  group_by(Division) %>%
  mutate(Total = sum(n),
         Percentage = round(n/Total * 100, 2)) %>%
  ungroup() %>%
  mutate(Occupations = as.character(Occupations),  # Convert to character
         Occupations = dplyr::recode(Occupations,
                                                    "1" =  "agricultural day labor",

                                                    "2" = "non-agricultural day labor",

                                                    "3" = "salaried",

                                                    "4" = "rickshaw/van puller",

                                                    "5" =  "self-employed",

                                                    "6" = "business/trade",

                                                    "7" = "production business",

                                                    "8" = "livestock-related work",

                                                    "9" = "farming",

                                                    "10" = "non-earning occupations"))

  # mutate(Gender = as.character(haven::zap_labels(Gender)),
  #        Gender = recode(Gender,
  #                        "0" = "Male",
  #                        "1" = "Female"))


p_hm <- ggplot(hhh_main_occup, aes(Division, Percentage, fill = Occupations)) +
  geom_bar(position = "stack", stat = "identity") + #, aes(text = paste0(Percentage, "%"))
  theme_classic() +
  labs(
    title = "Household Head Main Occupation by Division",
    x = "Division",
    y = "Percentage"
  ) +
  scale_fill_viridis_d() +
  scale_fill_manual(values = c("agricultural day labor" = "#440154", "non-agricultural day labor" = "#fde725",
                               "salaried" = "#3a528b", "rickshaw/van puller" = "#21918c", 
                               "self-employed" = "#ff7f00", "business/trade" = "#bd93f5", 
                               "production business" = "#5ec962", "livestock-related work" = "#cc4778",
                               "farming" = "#f6c2f8", "non-earning occupations" = "#b26600"))+
  coord_flip()+
  easy_plot_title_size(size = 16) +
  # easy_all_text_colour("#630031") +
  easy_center_title() +
  # ggeasy::easy_rotate_labels(which = "x", angle = 300) +
  ylim(0, 110)

p_hm <- ggplotly(p_hm)#, tooltip = "text"

p_hm




















```



